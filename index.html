<!DOCTYPE html>
<!-- saved from url=(0052)https://guides.github.com/introduction/git-handbook/ -->
<html lang="en">
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

      <title>Hexbin Tutorial</title>
      <!-- <link rel="icon" type="image/x-icon" href="https://guides.github.com/favicon.ico"> -->

      <meta name="viewport" content="width=device-width,initial-scale=1">

      <link rel="icon" href="internet.png" >

      <link rel="stylesheet" href="gridism.css">
      <link rel="stylesheet" href="markdown.css">
      <link rel="stylesheet" href="octicons.css">
      <link href="main.css" rel="stylesheet">
      <link href="pygments.css" rel="stylesheet">

      <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
      <link href="prism.css" rel="stylesheet" />

      <script type="text/javascript" async="" src="ga.js"></script><script src="jquery.js" type="text/javascript"></script>
      <script src="snap.svg-min.js" type="text/javascript"></script>
      <script src="application.js" type="text/javascript"></script>

      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-3769691-29']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>

    </head>

    <body style="background-color:#0099ff">

        <article class="full">
            <div class="article-heading js-article-heading js-geopattern" style="background-color:#0099ff">
                <div class="wrap">
                  <h1>Hexbin Mapping</h1>
                </div>
            </div>

            <div class="wrap">
                <div class="toc-wrapper"><ol class="toc js-toc sticky"></ol></div>

                <div class="markdown-body content-body">


                  <p><a id="overview" title="Overview" class="toc-item"></a></p>
                  <h3><i class="fa fa-spinner fa-spin"></i> Overview</h3>

                    <p> In this tutorial, we will explore how to change point data into a polygon chloropleth map, using hexagonal binning. We will then create a map using GeoJSON data. We will be examining violent crime (homicide, battery, assault, and sexual assault) for the city of Chicago, in 2018.

                    <p> Click <a href="https://drive.google.com/file/d/1IgvehM9ybBZbaz0bU5OlSxgMgb7JgmLo/view?usp=sharing" target="_blank">here</a></span> to download the data. Extract the data to your desired directory.</p>


                  <p><a id="prep" title="Download the MMQGIS Plugin" class="toc-item"></a></p>
                  <h3><i class="fa fa-spinner fa-spin"></i> Download the MMQGIS Plugin</h3>
                   <p>First, begin by opening QGIS. Then, in order to perform hexagonal binning, we will need to download a QGIS plugin that allows us to do so. In the menu bar under <b>Plugins</b> select <b>Manage and Install Plugins..</b>. Search for <i>MMQGIS</i> and click to install the plugin. If done correctly MMQGIS should now be displayed in the menu bar.</p>

                   <p><a id="prep" title="Upload the data" class="toc-item"></a></p>
                   <h3><i class="fa fa-spinner fa-spin"></i> Upload the Shapefile Data</h3>
                   <p> Once the plugin is installed you can now upload the Chicago "ViolentCrimes" point file. Make sure to select WGS84 as your coordinate system. There are a great deal of points, so this may take a while to fully display. (I named the point file "ViolentCrimes")</p>

                   <p><a id="prep" title="Creating the Bins" class="toc-item"></a></p>
                   <h3><i class="fa fa-spinner fa-spin"></i> Creating the Bins</h3>
                   <p> To start select MMQGIS in the menu bar and scroll down to <b>Create</b> and the select <b>Create Grid Layer</b>. Then select the following parameters and save the layer to the desired folder. Let's name the shapefile "crimehex".</p>

                   <img src="HexParameters.jpg" alt="Example" style="width:50%;">

                   <p> Once the hexagon polygon file is created, in the TOC, you can move the point file over the hexagons for a better view of what's going on. <br> </p>

                  <img src="Hexbehind.jpg" alt="Example" style="width:60%;">

                  <p> Next, navigate to <b>Vector</b> in the menu bar and scroll down to <b>Analysis Tools</b>. Then select <b>Count points in polygon</b>.</p>

                  <img src="Countpoints.jpg" alt="Example" style="width:60%;">

                  <p> In the parameters box use the settings displayed below. This process is essentially counting all of the points (from the crime point layer) that reside in each hexagon and assigning each polygon a count value. You have to option of saving the layer to a directory or creating a temporary file and saving it later. Choose whichever method you like! Hit <b>Run</b>.</p>

                  <img src="CountParameters.jpg" alt="Example" style="width:80%;">

                  <p>Once the process has run, a new hexagon layer will display over the point layer containing the counts. In order to get those counts to display, we will need to change the symbology. Open the new hexagon layers <b>Properties</b>, and change the symbol style from <b>Single symbol</b> to <b>Graduated</b>. Then imput the following parameters below.
                  <br>
                  <br>
                  Feel free to try and experiment with the different classification methods. Natural Breaks (Jenks) was chosen for this situation. <b>IMPORTANT! In to order to only display the hexagons with values in them, we will have to set the lowest value range at 1 instead of 0. </b></p>

                  <img src="PointCountAfter.jpg" alt="Example" style="width:80%;">

                  <img src="FinalParameters.jpg" alt="Example" style="width:80%;">

                  <img src="HexbinFinal.jpg" alt="Example" style="width:80%;">

                  <p>The final step in QGIS is to save the new hexbin layer as a GeoJSON. In order to preserve the symbology you <b>MUST</b> select to export the symbology as well. Make sure to set the coordinate system to WGS84 when doing so. After saving, QGIS can be closed.</p>

                  <img src="Symbology.jpg" alt="Example" style="width:80%;">

                    <p><a id="prep" title="Making the Map" class="toc-item"></a></p>
                    <h3><i class="fa fa-spinner fa-spin"></i> Making the Map</h3>

                   <ul>
                       <p>Open your desired <b>code editor</b> and add the following lines to prepare your page (you may copy and paste). The script in the head is the link to the Leaflest CSS file and the Leaflet JavaScript file. The script in the body sets up the map center, zoom and basemap.</p>

                   <pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Hexbin Mapping Tutorial&lt;/title&gt;

        &lt;link&gt;rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
        integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin=""/>

        &lt;script&gt; src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
        integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin="">&lt;/script&gt;

          #map {
            min-height: 100%;
            }

       &lt;/script&gt;

    &lt;/head&gt;

    &lt;body&gt;

    &lt;div&gt; id="map">&lt;/div&gt;

    &lt;script&gt; type="text/javascript">

      var map = L.map('map', {
          center: [41.83,-88.01],
          zoom: 11
      });

      L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
           attribution: '@ &lt;a&gt; href="https://www.openstreetmap.org/copyright">OpenStreetMap&lt;/a&gt; contributors',
        }).addTo(map);

    &lt;/body&gt;
&lt;/html&gt;</code></pre>
                       </li>
                   <p>Save the document as <code>HexbinTutorial.html</code> to your desired directory. As a reminder, you will need to <b>TYPE the file extension as .html</b> for it to properly function. </p>

                <p>Next, we will import the GeoJSON file. In your code editor, open the GeoJSON file you created for the hexbin layer. I used the name <b>Chidata</b> to define the data variable, but you may use whatever name you deem worthy!</p>

                <img src="Vardata.jpg" alt="Example" style="width:100%;">

                <p> Once you've defined the variable, you can save the GeoJSON as a <b>.js</b> file. </p>

                <p><a id="prep" title="Adding the .js file and adjusting the symbology" class="toc-item"></a></p>
                <h3><i class="fa fa-spinner fa-spin"></i> Adding the .js file and adjusting the symbology</h3>

                <p>In the head section, just below the JavaScript link copy, add the script to reference your data .js file. </p>

                <pre><code class="language-html">&lt;script src="ChiCrime.js"&gt;&lt;/script&gt;</code></pre>

                 <p> Now that your JavaScript file is referenced in your html document, you can begin to change the symbology. We can do that, as we've done in previous labs, by adding the <b>getColor</b> function and the <b>style</b>. These functions should be added in the body, per usual. </p>

                 <pre><code class="language-html">
function getColor(value) {
  return value < 30 ? '#edf8e9':
         value < 96 ? '#bae4b3':
         value < 191 ? '#74c476':
         value < 329 ? '#31a354':
         value < 629 ? '#006d2c':
                       '#006d2c';}

function style(feature){
  return {
  fillColor: getColor(feature.properties.NUMPOINTS),
      weight: 2,
      opacity: 1,
      color: 'black',
      fillOpacity: 1
                    };
                        }</code></pre>
<p> Using the ranges from the grauated color symbology, from QGIS, I was able to set the color ranges for the hexgon layer. I used a green color pallet from <a href="http://colorbrewer2.org/#type=sequential&scheme=Greens&n=5"> Color Brewer </a> to symbolize the crime. </p>

<p>The final step to get the data to display is simply adding the <b>Chidata</b> using the <b>L.geoJson</b> function. If done correctly your hexbin data should be displayed over your basemap!</p><pre><code class="language-html">L.geoJson(Chidata, {style:style}).addTo(map);</code></pre>

<p><a id="prep" title="Adding a Title" class="toc-item"></a></p>
<h3><i class="fa fa-spinner fa-spin"></i> Adding a Title</h3>

<p>For fun I decided to add a title to the map which, you may or may not want to do yourself. If so, add this portion of script to the <b>head</b> section, under the <b>ChiCrime .js reference</b> : </p>

<pre><code class="language-html">&lt;script type="text/css">
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    }

  #map {
    min-height: 100%;
    }

    .title {
        padding: 6px 8px;
        font-family: 'sans-serif';font-size: 22px;
        background: white;
        background: rgba(255,255,255,0.8);
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        border-radius: 5px;
    }

&lt;/style&gt;
</code></pre>

<p> Then add this script to the body section, after the <b>L.geoJson</b>:</p>
<pre><code class="language-html">var title = L.control({position: 'topright'});

title.onAdd = function (map) {
  this._div = L.DomUtil.create('div', 'title');
  this._div.innerHTML = "&lt;h3&gt;Hexbin Mapping&lt;/h3&gt;";
  return this._div;
};

title.addTo(map);
</code></pre>

<p> Here is my final map where you can generate the source <a href="https://dillonepping.github.io/tutorialmap/"> code </a>.</p>




<h3>For additional reference, please feel free to visit my sources:</h3>
<li><a href="https://www.gislounge.com/using-qgis-create-hexbin-map-gisp-registrations/">Using QGIS to Create a Hexbin Map of GISP Registrations by <b>Caitlin Dempsey</b></a>
<br> <li><a href="https://leafletjs.com/examples/choropleth/">Interactive Choropleth Map by <b>Vladimir Agafonkin</b></a>

     </body>

</html>
